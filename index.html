<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Filterable Photo Gallery | Bocaletto Luca</title>
  <meta name="description" content="Photo gallery responsive con filtri CSS, lightbox, preset e preferiti in LocalStorage.">
  <meta name="keywords" content="galleria foto, CSS filters, lightbox, responsive, preset, preferiti, JSON">
  <link rel="canonical" href="https://github.com/bocaletto-luca/FilterablePhotoGallery">
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fafbfc;
      --header-bg: #2563eb;
      --footer-bg: #1e3a8a;
      --card: #ffffff;
      --text: #1f2937;
      --border: #e5e7eb;
      --accent: #10b981;
      --accent-dark: #047857;
      --radius: 8px;
      --gap: 1rem;
      --filter: none;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);
      display:flex;flex-direction:column;min-height:100vh;}
    header{background:var(--header-bg);color:#fff;text-align:center;padding:var(--gap);}
    header h1{font-size:1.75rem;margin:0;}
    main{flex:1;max-width:1000px;width:100%;margin:var(--gap) auto;padding:0 var(--gap);}
    #controls{display:flex;flex-wrap:wrap;gap:var(--gap);justify-content:center;margin-bottom:var(--gap);}
    #controls select,#controls input[type="text"],#controls button{
      padding:.5rem .75rem;border:1px solid var(--border);border-radius:var(--radius);
      font:inherit;}
    #controls button{background:var(--accent);color:#fff;cursor:pointer;transition:background .2s;}
    #controls button:hover{background:var(--accent-dark);}
    #gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:var(--gap);}
    .g-item{position:relative;background:var(--card);border-radius:var(--radius);
      overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.1);cursor:pointer;}
    .g-item img{width:100%;height:auto;display:block;filter:var(--filter);
      transition:filter .3s;}
    .caption{position:absolute;bottom:0;left:0;right:0;
      background:rgba(0,0,0,0.6);color:#fff;font-size:.85rem;
      padding:.25rem;text-align:center;}
    .fav-star{position:absolute;top:.5rem;right:.5rem;
      font-size:1.25rem;color:rgba(255,255,255,0.8);
      text-shadow:0 0 2px #000;cursor:pointer;transition:color .2s;}
    .fav-star.fav{color:#facc15;}
    #lightbox{position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.85);display:flex;align-items:center;
      justify-content:center;visibility:hidden;opacity:0;transition:opacity .3s;
      z-index:1000;}
    #lightbox.open{visibility:visible;opacity:1;}
    #lb-content{position:relative;max-width:90%;max-height:90%;text-align:center;}
    #lb-img{max-width:100%;max-height:80vh;filter:var(--filter);}
    #lb-caption{margin-top:.5rem;color:#fff;font-size:1rem;}
    .lb-nav{position:absolute;top:50%;left:0;right:0;
      display:flex;justify-content:space-between;transform:translateY(-50%);}
    .lb-nav button{background:rgba(0,0,0,0.5);border:none;color:#fff;
      font-size:2rem;padding:.5rem;cursor:pointer;border-radius:var(--radius);}
    #lb-close{position:absolute;top:-1rem;right:-1rem;
      background:var(--accent);color:#fff;border:none;border-radius:50%;
      width:2.5rem;height:2.5rem;font-size:1.5rem;cursor:pointer;}
    #lb-fav{position:absolute;bottom:-2rem;left:50%;transform:translateX(-50%);
      background:var(--accent);color:#fff;border:none;padding:.4rem .8rem;
      border-radius:var(--radius);cursor:pointer;}
    #io{display:flex;justify-content:center;gap:var(--gap);margin:var(--gap) 0;}
    #io button{background:var(--accent);color:#fff;border:none;padding:.5rem 1rem;
      border-radius:var(--radius);cursor:pointer;transition:background .2s;}
    #io button:hover{background:var(--accent-dark);}
    #file-input{display:none;}
    footer{background:var(--footer-bg);color:#fff;text-align:center;padding:.75rem;}
    footer a{color:#fff;text-decoration:underline;}
    @media(max-width:600px){#controls{flex-direction:column;align-items:stretch}}
    /* HELP OVERLAY */
    #help-overlay {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.8); color:#fff;
      display: none; flex-direction: column; align-items:center;
      justify-content: center; padding:2rem; z-index:2000;
      text-align:left; overflow-y:auto;
    }
    #help-overlay.visible { display:flex; }
    #help-content {
      background: var(--card); color: var(--text);
      border-radius: var(--radius); padding:2rem;
      max-width:800px; width:100%; max-height:90vh; overflow-y:auto;
    }
    #help-content h2 { margin-top:0; }
    #help-close {
      margin-top:1rem; padding:.5rem 1rem;
      background: var(--accent); color:#fff;
      border:none; border-radius:var(--radius);
      cursor:pointer; transition:background .2s;
    }
    #help-close:hover { background: var(--accent-dark); }
  </style>
</head>
<body>

  <header role="banner">
    <h1>Filterable Photo Gallery</h1>
  </header>

  <main role="main">
    <div id="controls">
      <button id="help-btn">Help</button>
      <select id="filter-select" aria-label="Preset filtri"></select>
      <button id="show-all">Show All</button>
      <button id="show-fav">Show Favorites</button>
      <input type="text" id="preset-name" placeholder="Nome preset">
      <input type="text" id="preset-filter" placeholder="Filtro CSS es: sepia(1)">
      <button id="add-preset">Aggiungi Preset</button>
    </div>

    <section id="gallery" aria-label="Galleria fotografica"></section>

    <div id="io">
      <button id="export-json">Export JSON</button>
      <button id="import-json">Import JSON</button>
      <input type="file" id="file-input" accept=".json">
    </div>
  </main>

  <div id="help-overlay">
    <div id="help-content">
      <h2>Guida all'uso</h2>
      <p><strong>Preset Filtri:</strong> seleziona un filtro CSS (es. bianco/nero, seppia, saturazione).</p>
      <p><strong>Show All / Show Favorites:</strong> mostra tutte le foto o solo quelle segnate come preferite.</p>
      <p><strong>Aggiungi Preset:</strong> inserisci un nome e una stringa CSS filter, poi clicca per salvare.</p>
      <p><strong>Galleria:</strong> clicca su una miniatura per aprire il lightbox.</p>
      <p><strong>Lightbox:</strong> naviga con ◀ ▶, chiudi con ✕. Clicca ★ per aggiungere/rimuovere dai preferiti.</p>
      <p><strong>Export/Import JSON:</strong> salva o carica i tuoi <em>favorites</em> e <em>presets</em> in un file JSON.</p>
      <button id="help-close">Chiudi Guida</button>
    </div>
  </div>

  <!-- Lightbox markup (invisibile finché non aperto) -->
  <div id="lightbox">
    <div id="lb-content">
      <button id="lb-close" aria-label="Chiudi">&times;</button>
      <img id="lb-img" src="" alt="">
      <div id="lb-caption"></div>
      <div class="lb-nav">
        <button id="lb-prev" aria-label="Precedente">&larr;</button>
        <button id="lb-next" aria-label="Successivo">&rarr;</button>
      </div>
      <button id="lb-fav" aria-label="Toggle favorite">★</button>
    </div>
  </div>

  <footer role="contentinfo">
    © 2025 Bocaletto Luca — 
    <a href="https://github.com/bocaletto-luca/FilterablePhotoGallery" target="_blank" rel="noopener">
      GitHub
    </a> — Licensed GPLv3
  </footer>

  <script>
    // immagini di esempio
    const images = [
      {url:'https://picsum.photos/id/1015/600/400',caption:'Mountain'},
      {url:'https://picsum.photos/id/1024/600/400',caption:'Dog'},
      {url:'https://picsum.photos/id/1025/600/400',caption:'Kitten'},
      {url:'https://picsum.photos/id/1035/600/400',caption:'Beach'},
      {url:'https://picsum.photos/id/1042/600/400',caption:'Forest'},
      {url:'https://picsum.photos/id/1021/600/400',caption:'Lake'},
      {url:'https://picsum.photos/id/1050/600/400',caption:'Desert'},
      {url:'https://picsum.photos/id/1069/600/400',caption:'City'},
      {url:'https://picsum.photos/id/1074/600/400',caption:'Bridge'}
    ];

    // stato
    let favorites = JSON.parse(localStorage.getItem('favs')||'[]');
    let presets   = JSON.parse(localStorage.getItem('presets')||'[]');
    if(!presets.length){
      presets = [
        {name:'None',filter:'none'},
        {name:'Grayscale',filter:'grayscale(1)'},
        {name:'Sepia',filter:'sepia(1)'},
        {name:'Saturate',filter:'saturate(1.5)'}
      ];
      localStorage.setItem('presets',JSON.stringify(presets));
    }
    let currentFilter = 'none';
    let showingFavs   = false;
    let currentIndex  = 0;

    // elementi
    const gallery      = document.getElementById('gallery');
    const filterSelect = document.getElementById('filter-select');
    const showAllBtn   = document.getElementById('show-all');
    const showFavBtn   = document.getElementById('show-fav');
    const presetNameIn = document.getElementById('preset-name');
    const presetFilterIn = document.getElementById('preset-filter');
    const addPresetBtn = document.getElementById('add-preset');
    const exportBtn    = document.getElementById('export-json');
    const importBtn    = document.getElementById('import-json');
    const fileInput    = document.getElementById('file-input');
    const helpBtn      = document.getElementById('help-btn');
    const helpOverlay  = document.getElementById('help-overlay');
    const helpClose    = document.getElementById('help-close');
    const lightbox     = document.getElementById('lightbox');
    const lbImg        = document.getElementById('lb-img');
    const lbCaption    = document.getElementById('lb-caption');
    const lbClose      = document.getElementById('lb-close');
    const lbPrev       = document.getElementById('lb-prev');
    const lbNext       = document.getElementById('lb-next');
    const lbFavBtn     = document.getElementById('lb-fav');

    function init(){
      renderPresets();
      renderGallery();
      bindControls();
    }

    function renderPresets(){
      filterSelect.innerHTML='';
      presets.forEach((p,i)=>{
        const o=document.createElement('option');
        o.value=i; o.textContent=p.name;
        filterSelect.append(o);
      });
      filterSelect.value=0;
      applyFilter(presets[0].filter);
    }

    function applyFilter(f){
      currentFilter=f||'none';
      document.documentElement.style.setProperty('--filter',currentFilter);
    }

    function renderGallery(){
      gallery.innerHTML='';
      images.forEach((img,i)=>{
        if(showingFavs && !favorites.includes(i)) return;
        const div=document.createElement('div');
        div.className='g-item'; div.dataset.index=i;
        const el=document.createElement('img');
        el.src=img.url; el.alt=img.caption;
        const cap=document.createElement('div');
        cap.className='caption'; cap.textContent=img.caption;
        const star=document.createElement('div');
        star.className='fav-star'+(favorites.includes(i)?' fav':'');
        star.textContent='★';
        star.onclick=e=>{e.stopPropagation();toggleFav(i);};
        div.append(el,cap,star);
        div.onclick=()=>openLightbox(i);
        gallery.append(div);
      });
    }

    function toggleFav(i){
      const idx = favorites.indexOf(i);
      if(idx>=0) favorites.splice(idx,1);
      else favorites.push(i);
      localStorage.setItem('favs',JSON.stringify(favorites));
      renderGallery();
      updateLightboxFav();
    }

    function openLightbox(i){
      currentIndex=i; showImage(i);
      lightbox.classList.add('open');
    }
    function closeLightbox(){ lightbox.classList.remove('open'); }
    function prevImage(){ currentIndex=(currentIndex-1+images.length)%images.length; showImage(currentIndex);}
    function nextImage(){ currentIndex=(currentIndex+1)%images.length; showImage(currentIndex);}
    function showImage(i){
      const img=images[i];
      lbImg.src=img.url; lbImg.alt=img.caption;
      lbCaption.textContent=img.caption;
      updateLightboxFav();
    }
    function updateLightboxFav(){
      lbFavBtn.textContent=favorites.includes(currentIndex)?'★':'☆';
    }
    function toggleLightboxFav(){ toggleFav(currentIndex); }

    function bindControls(){
      filterSelect.onchange = ()=>applyFilter(presets[filterSelect.value].filter);
      showAllBtn.onclick    = ()=>{ showingFavs=false; renderGallery(); };
      showFavBtn.onclick    = ()=>{ showingFavs=true; renderGallery(); };
      addPresetBtn.onclick  = ()=>{
        const n=presetNameIn.value.trim(), f=presetFilterIn.value.trim();
        if(!n||!f) return;
        presets.push({name:n,filter:f});
        localStorage.setItem('presets',JSON.stringify(presets));
        presetNameIn.value=''; presetFilterIn.value='';
        renderPresets();
      };
      exportBtn.onclick = ()=>{
        const data={presets,favorites};
        const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
        const url=URL.createObjectURL(blob), a=document.createElement('a');
        a.href=url; a.download='gallery-data.json'; a.click();
        URL.revokeObjectURL(url);
      };
      importBtn.onclick = ()=>fileInput.click();
      fileInput.onchange = e=>{
        const f=e.target.files[0]; if(!f) return;
        const r=new FileReader();
        r.onload=()=>{
          try{
            const d=JSON.parse(r.result);
            if(d.presets && d.favorites){
              presets=d.presets;
              favorites=d.favorites;
              localStorage.setItem('presets',JSON.stringify(presets));
              localStorage.setItem('favs',JSON.stringify(favorites));
              renderPresets();
              renderGallery();
            } else alert('Struttura JSON non valida');
          } catch{
            alert('Impossibile leggere il JSON');
          }
        };
        r.readAsText(f);
      };
      helpBtn.onclick   = ()=> helpOverlay.classList.add('visible');
      helpClose.onclick = ()=> helpOverlay.classList.remove('visible');
      lbClose.onclick   = closeLightbox;
      lbPrev.onclick    = prevImage;
      lbNext.onclick    = nextImage;
      lbFavBtn.onclick  = toggleLightboxFav;
      document.addEventListener('keydown',e=>{
        if(helpOverlay.classList.contains('visible') && e.key==='Escape'){
          helpOverlay.classList.remove('visible'); return;
        }
        if(!lightbox.classList.contains('open')) return;
        if(e.key==='Escape') closeLightbox();
        if(e.key==='ArrowLeft') prevImage();
        if(e.key==='ArrowRight') nextImage();
      });
    }

    init();
  </script>
</body>
</html>
